# ğŸ¯ Next Session: Warden Core Engine Integration with Ink CLI

## ğŸ“‹ Current Status

### âœ… Completed (This Session)
1. **Ink CLI Framework** - Fully functional TypeScript/React CLI
2. **9 Commands** - All registered and working (/help, /scan, /analyze, etc.)
3. **File Picker (@)** - Interactive file/folder browser with Tab completion
4. **IPC Bridge** - Node.js â†” Python communication via socket
5. **Path Resolution** - @ prefix removal working perfectly
6. **ESM Build** - Clean production build without errors

### ğŸ”§ Architecture Overview

**Warden Core (Python)**
- Location: `/Users/alper/Documents/Development/Personal/warden-core/`
- TUI Commands: `src/warden/tui/commands/` (scan.py, analyze.py, etc.)
- Pipeline: `PipelineOrchestrator` - executes validation frames
- Validation: Custom frames in `src/warden/validation/`

**Ink CLI (TypeScript/Node)**
- Location: `/Users/alper/Documents/Development/Personal/warden-core/cli/`
- Commands: `src/handlers/` (scanCommand.ts, analyzeCommand.ts, etc.)
- IPC Client: `src/bridge/wardenClient.ts`
- Global binary: `warden-chat`

### âš ï¸ Current Problem

**Validation Framework Not Available**
```
Error: Warden validation framework not available
```

**Root Cause:**
- Ink CLI calls IPC server's `execute_pipeline(file_path)`
- IPC server tries to initialize PipelineOrchestrator
- Orchestrator requires validation frames from config
- Config loading or frame imports failing

---

## ğŸ¯ Next Session Goal

**Make Warden Core validation framework accessible from Ink CLI**

### Primary Objective
Fix the validation framework initialization so `/scan` and `/analyze` commands can:
1. Load validation frames from config
2. Execute full pipeline on Python files
3. Return real security findings (not mock data)
4. Display results in Ink CLI

### Key Files to Investigate

**Python Side:**
1. `src/warden/pipeline/application/orchestrator.py` - Pipeline execution
2. `src/warden/validation/` - Frame system
3. `src/warden/config/` - Configuration loading
4. `start_ipc_server.py` - IPC server initialization
5. `src/warden/tui/commands/scan.py` - Reference implementation (WORKS in TUI)

**TypeScript Side:**
1. `cli/src/bridge/wardenClient.ts` - IPC communication
2. `cli/src/handlers/scanCommand.ts` - Command handler
3. `cli/src/handlers/analyzeCommand.ts` - File analysis

---

## ğŸ” Investigation Steps

### 1. Understand Why TUI Works But CLI Doesn't

**TUI Scan Command:**
```python
# src/warden/tui/commands/scan.py:62
if orchestrator:
    await _run_pipeline_scan(scan_path, orchestrator, add_message, app)
```

**Question:** How does TUI initialize `orchestrator`?
- Check: `src/warden/tui/app.py` - app initialization
- Find: Where PipelineOrchestrator is created
- Compare: TUI initialization vs IPC server initialization

### 2. Fix IPC Server Initialization

**Current IPC Server:**
```python
# start_ipc_server.py (needs inspection)
# Does it:
# - Load config properly?
# - Initialize PipelineOrchestrator?
# - Import validation frames?
```

**TODO:**
- [ ] Read `start_ipc_server.py` completely
- [ ] Identify missing initialization steps
- [ ] Add PipelineOrchestrator setup
- [ ] Test frame loading

### 3. Configuration

**Check:**
- Where is validation config? (`pyproject.toml`? `.warden/config.yaml`?)
- What frames are registered?
- Are frame paths correct?
- Are imports working?

### 4. Test End-to-End

```bash
# Start backend
python3 start_ipc_server.py

# Test from CLI
warden-chat
> /scan @examples/
# Should show REAL validation results, not "framework not available"
```

---

## ğŸ“ Project Structure Reference

```
warden-core/
â”œâ”€â”€ cli/                          # Ink CLI (TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ bridge/
â”‚   â”‚   â”‚   â””â”€â”€ wardenClient.ts   # IPC client
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”œâ”€â”€ scanCommand.ts    # /scan handler
â”‚   â”‚   â”‚   â””â”€â”€ analyzeCommand.ts # /analyze handler
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â””â”€â”€ InputBox.tsx      # File picker (@)
â”‚   â””â”€â”€ dist/                     # Compiled JS
â”‚
â”œâ”€â”€ src/warden/
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â””â”€â”€ application/
â”‚   â”‚       â””â”€â”€ orchestrator.py   # Pipeline execution engine
â”‚   â”œâ”€â”€ validation/
â”‚   â”‚   â”œâ”€â”€ domain/frame.py       # Frame base classes
â”‚   â”‚   â””â”€â”€ frames/               # Validation frames
â”‚   â”œâ”€â”€ tui/
â”‚   â”‚   â”œâ”€â”€ app.py                # TUI application (reference)
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â””â”€â”€ scan.py           # Working scan implementation
â”‚   â””â”€â”€ cli_bridge/               # IPC server code
â”‚
â””â”€â”€ start_ipc_server.py           # IPC server entry point
```

---

## ğŸ¯ Success Criteria

**Session Complete When:**

1. âœ… `/scan @src/` shows real validation findings
2. âœ… `/analyze @file.py` shows security issues for specific file
3. âœ… No "framework not available" errors
4. âœ… Progress updates work (frame execution)
5. âœ… Results match what TUI would show

**Expected Output:**
```
> /scan @examples/

ğŸ” Scanning: /path/to/examples
ğŸ“Š Found 8 Python files. Running full pipeline...

ğŸš€ Pipeline started
Running 5 frames on 8 files...

âœ… SQLInjectionFrame [1/5] Issues: 2 | 0.3s
âœ… XSSFrame [2/5] Issues: 0 | 0.2s
âœ… PathTraversalFrame [3/5] Issues: 1 | 0.4s
...

ğŸ“Š Scan Summary
Total Issues: 3
Critical: 1
High: 2
```

---

## ğŸ’¡ Hints

1. **Compare TUI vs IPC:**
   - TUI works â†’ study its initialization
   - Copy working patterns to IPC server

2. **Frame Loading:**
   - Check if frames are in Python path
   - Verify imports don't fail
   - Look for config file

3. **Error Handling:**
   - Add verbose logging to IPC server
   - Log each initialization step
   - Identify where it fails

4. **Dependencies:**
   - Are all Python deps installed?
   - Is virtual env activated?
   - Check import errors in console

---

## ğŸš€ Quick Start Commands (Next Session)

```bash
# Navigate to project
cd /Users/alper/Documents/Development/Personal/warden-core

# Activate venv (if exists)
source .venv/bin/activate  # or poetry shell

# Check what breaks
python3 -c "from warden.pipeline.application.orchestrator import PipelineOrchestrator; print('OK')"

# Read IPC server
cat start_ipc_server.py

# Compare with TUI
cat src/warden/tui/app.py | grep -A 20 "PipelineOrchestrator"

# Test manually
python3
>>> from warden.pipeline.application.orchestrator import PipelineOrchestrator
>>> # Try to initialize...
```

---

## ğŸ“ Session Goal Summary

**INPUT:** Ink CLI with "framework not available" error
**OUTPUT:** Fully working validation pipeline accessible from CLI
**BLOCKER:** PipelineOrchestrator initialization in IPC server

**Focus:** Python backend integration, NOT TypeScript CLI fixes
**Reference:** TUI implementation (already works)
**Test:** `/scan @examples/` should show real findings

Good luck! ğŸš€
