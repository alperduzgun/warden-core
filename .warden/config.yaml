# Warden Pipeline Configuration
# This is the project-specific config for warden-core

version: "1.0"
name: "Warden Core Development Pipeline"

# Validation frames to run
frames:
  # Core validation frames
  - security      # Critical security checks
  - fuzz          # Edge case testing
  - property      # Logic validation
  - architectural # Code organization

  # Git integration frames
  - gitchanges    # Analyze only changed lines (CI/CD)
  - orphan        # Dead code detection

# Pipeline settings
settings:
  fail_fast: true     # Stop on first blocker failure
  parallel: false     # Sequential execution for debugging
  timeout: 300        # 5 minutes max per frame

  # Enhanced pipeline features
  enable_discovery: true         # Auto-discover project files
  enable_build_context: true     # Load build configuration
  enable_suppression: true       # Filter false positives (comment-based)
  enable_issue_validation: true  # Apply confidence-based false positive detection
  enable_llm: true               # Use LLM for enhanced analysis
  llm_provider: "azure_openai"   # LLM provider (azure_openai/openai/deepseek/groq/anthropic)

# Frame-specific configurations
frame_config:
  gitchanges:
    compare_mode: "staged"      # Options: "staged", "unstaged", "branch"
    base_branch: "main"         # Base branch for comparison
    include_context: false      # Include context lines

  orphan:
    # === LLM-POWERED INTELLIGENT FILTERING (NEW!) ===
    use_llm_filter: true        # Enable LLM for intelligent false positive filtering
                                # - Detects @property, @abstractmethod, Protocol, etc.
                                # - Works for ALL languages (Python, JS, Go, Rust, etc.)
                                # - Reduces false positives from 60-70% to <10%
                                # - Cost: ~$0.20 per full scan, ~$0.01 per incremental
                                # - Duration: ~2 minutes for 200+ files

    # === BASIC FILTERING (FALLBACK) ===
    ignore_private: true        # Ignore private functions/classes (when LLM disabled)
    ignore_test_files: true     # Skip test files
    ignore_imports:             # Imports to always ignore
      - "pytest"
      - "unittest"
      - "annotations"
      - "TYPE_CHECKING"

# Discovery configuration
discovery:
  use_gitignore: true           # Respect .gitignore patterns
  max_depth: null               # No depth limit

# Suppression configuration
suppression:
  config_path: ".warden/suppressions.yaml"  # Path to suppressions file

# Issue validation configuration (confidence-based false positive detection)
issue_validation:
  minimum_confidence: 0.5      # Reject issues with confidence < 0.5 (50%)
  minimum_title_length: 10     # Minimum title length for quality check
  # Enabled rules (all enabled by default):
  # - ConfidenceThresholdRule: Validates minimum confidence
  # - LineNumberRangeRule: Validates line number exists
  # - CodeSnippetMatchRule: Validates code snippet matches file content
  # - EvidenceQuoteRule: Validates evidence quotes exist in code
  # - TitleDescriptionQualityRule: Validates title quality (no placeholders)

# Semantic search configuration (always enabled)
semantic_search:
  enabled: true                       # Enable semantic code search
  qdrant_url: "http://localhost:6333"  # Qdrant server URL (or cloud URL)
  qdrant_api_key: null                # Qdrant API key (required for cloud)
  collection_name: "warden_code_index"  # Qdrant collection name
  chunk_size: 500                     # Maximum lines per code chunk
  embedding_model: "text-embedding-3-small"  # OpenAI embedding model
  embedding_provider: "openai"        # Provider: openai or azure_openai
  search_limit: 10                    # Default max search results
  min_search_score: 0.5               # Minimum similarity score (0.0-1.0)
  max_context_tokens: 4000            # Max tokens for LLM context retrieval

# Infrastructure configuration
infrastructure:
  ci_provider: "github"          # CI provider: github, gitlab, azure
  hooks:
    pre_commit: true             # Enable pre-commit hook
    pre_push: false              # Enable pre-push hook
  installer:
    auto_update: false           # Auto-update Warden in CI

# Project-specific ignore patterns (future feature)
# ignore_patterns:
#   - "*/tests/*"
#   - "*/temp/*"
