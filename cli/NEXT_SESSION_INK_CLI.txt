# üéØ Warden Ink CLI - Next Session Prompt

## üìç CURRENT STATUS (2025-12-22)

### ‚úÖ COMPLETED TODAY

**Session 1: /scan Command**
- ‚úÖ scanCommand.ts implemented (309 lines)
- ‚úÖ Directory scanning with file discovery
- ‚úÖ Progress tracking ([1/N] for each file)
- ‚úÖ Aggregated results (severity breakdown, top files)
- ‚úÖ Registered in commandRouter
- ‚úÖ TypeScript build: 0 errors

**Session 2: Slash Command List (Claude Code Style)**
- ‚úÖ Auto-show command list when user types "/"
- ‚úÖ Two-column layout (command | description)
- ‚úÖ Fixed width left column (30 chars)
- ‚úÖ Flexible right column (descriptions)
- ‚úÖ Shows aliases: /analyze (/a, /check)
- ‚úÖ Clean UI (no border, cyan + gray colors)
- ‚úÖ Fixed detection bug (now works with just "/")

**Files Modified (2 files):**
1. cli/src/handlers/scanCommand.ts (NEW - 309 lines)
2. cli/src/components/InputBox.tsx (MODIFIED - slash list)
3. cli/src/utils/commandDetector.ts (FIXED - regex bug)

**Build Status:**
- TypeScript: 0 errors ‚úÖ
- Global command: warden-chat ‚úÖ
- IPC server: ready (start_ipc_server.py) ‚úÖ

### üìä COMMAND STATUS (6/9 implemented = 67%)

| Command   | Status | IPC  | Lines | Features                              |
|-----------|--------|------|-------|---------------------------------------|
| /help     | ‚úÖ     | No   | 75    | Full help text                        |
| /status   | ‚úÖ     | Yes  | 115   | Session/config via IPC                |
| /clear    | ‚úÖ     | No   | 95    | Clear chat                            |
| /quit     | ‚úÖ     | No   | 95    | Exit                                  |
| /analyze  | ‚úÖ     | Yes  | 260   | Full pipeline on single file          |
| /scan     | ‚úÖ     | Yes  | 309   | Directory scan + progress ‚Üê NEW!      |
| /validate | ‚ùå     | Yes  | -     | Run specific validation frames        |
| /fix      | ‚ùå     | Yes  | -     | Auto-fix issues                       |
| /rules    | ‚ùå     | No   | -     | Manage custom rules                   |

---

## üöÄ NEXT SESSION PRIORITIES

### Priority 1: Test Current Features (HIGH)

**Goal:** Verify everything works end-to-end

```bash
# Terminal 1: Start IPC server
cd /Users/alper/Documents/Development/Personal/warden-core
python3 start_ipc_server.py

# Terminal 2: Test CLI
warden-chat

# Test slash command list
> /
# Should show: /help, /status, /clear, /quit, /analyze, /scan

# Test scan command (if IPC works)
> /scan test_sample.py
# Should show progress + results

# Test analyze command
> /analyze test_sample.py
# Should show detailed analysis
```

**Expected Issues to Fix:**
1. IPC connection might fail (check socket path)
2. Progress updates might not work properly
3. JSON serialization issues (Panel compatibility)

**Action Items:**
- [ ] Fix any IPC connection issues
- [ ] Test all 6 implemented commands
- [ ] Verify Panel JSON compatibility
- [ ] Document any bugs found

---

### Priority 2: Implement /validate Command (MEDIUM)

**Reference:** src/warden/tui/commands/validate.py (Python)

**Features Needed:**
- Run specific validation frames on a file
- Frame selection (user picks which frames to run)
- Display frame-specific results
- IPC: validate_file(file_path, frames[])

**Implementation Plan:**
1. Create cli/src/handlers/validateCommand.ts
2. Parse args: /validate <file> [frame1,frame2,...]
3. Call IPC: client.validateFile(file, frames)
4. Display results (similar to analyze but frame-specific)
5. Register in commandRouter
6. Max 500 lines (RULE)

**Estimated Time:** 30-45 minutes

---

### Priority 3: Keyboard Navigation for Command List (MEDIUM)

**Goal:** Make command selection interactive (like Claude Code)

**Features:**
- Arrow Up/Down: Navigate through commands
- Tab: Highlight next command
- Enter: Auto-complete selected command
- Escape: Close list
- Visual highlight for selected command

**Implementation:**
1. Add selectedIndex state in InputBox
2. Listen for arrow key events
3. Highlight selected command (different color/background)
4. On Enter: auto-fill input with selected command
5. Update InputBox.tsx

**Estimated Time:** 45-60 minutes

---

### Priority 4: Implement /fix Command (LOW)

**Reference:** Claude Code auto-fix pattern

**Features:**
- Auto-fix issues in code
- Backup original file
- Show diff of changes
- Confirm before applying
- IPC: fix_issues(file_path, issue_ids[])

**Implementation Plan:**
1. Create cli/src/handlers/fixCommand.ts
2. Parse args: /fix <file> [issue_id1,issue_id2,...]
3. Backup file: file.bak
4. Apply fixes via IPC
5. Show diff (before/after)
6. Confirmation prompt
7. Max 500 lines

**Estimated Time:** 60 minutes

---

### Priority 5: Implement /rules Command (LOW)

**Features:**
- Subcommands: list, show <id>, stats
- Display custom validation rules
- Read from .warden/rules.yaml
- No IPC needed (local file read)

**Implementation:**
1. Create cli/src/handlers/rulesCommand.ts
2. Parse subcommands
3. Read .warden/rules.yaml
4. Display formatted output
5. Max 500 lines

**Estimated Time:** 30 minutes

---

## üêõ KNOWN ISSUES

1. **IPC Connection Not Tested**
   - start_ipc_server.py created but not tested
   - Socket path: /tmp/warden-ipc.sock
   - Need to verify connection works

2. **Progress Updates Not Real-Time**
   - /scan shows progress but not live
   - Need streaming updates from IPC
   - Consider WebSocket or SSE

3. **Command List Always Shows All Commands**
   - Should filter as user types (e.g., "/an" shows only /analyze)
   - Easy fix: add filtering logic

4. **No Command Palette Yet**
   - Ctrl+P should open command palette
   - Future feature

5. **No File Picker Yet**
   - @ should trigger file picker
   - Future feature

---

## üìö REFERENCE FILES

**Handlers (Existing):**
- cli/src/handlers/helpCommand.ts
- cli/src/handlers/statusCommand.ts
- cli/src/handlers/analyzeCommand.ts
- cli/src/handlers/scanCommand.ts ‚Üê NEW!
- cli/src/handlers/commandRouter.ts

**Python TUI Reference (for new commands):**
- src/warden/tui/commands/validate.py
- src/warden/tui/commands/help.py
- src/warden/tui/display/analysis.py

**IPC Bridge:**
- src/warden/cli_bridge/protocol.py
- src/warden/cli_bridge/bridge.py
- cli/src/bridge/wardenClient.ts

**Components:**
- cli/src/components/InputBox.tsx ‚Üê Modified for slash list
- cli/src/components/ChatArea.tsx
- cli/src/components/Header.tsx

---

## üéØ SUCCESS CRITERIA

**Milestone 1: Basic Functionality (CURRENT)**
- [x] CLI connects to IPC server
- [x] /help shows full help text
- [x] /status shows session info
- [x] /clear clears chat
- [x] /quit exits gracefully
- [x] /analyze calls pipeline
- [x] /scan scans directory ‚Üê NEW!
- [x] Slash command list works ‚Üê NEW!
- [ ] **All commands tested with IPC backend** ‚Üê NEXT!

**Milestone 2: Feature Parity (2-3 sessions)**
- [ ] /validate implemented
- [ ] /fix implemented
- [ ] /rules implemented
- [ ] Keyboard navigation for command list
- [ ] Command filtering as user types
- [ ] All 9 commands working

**Milestone 3: Production Ready (1 week)**
- [ ] Command Palette (Ctrl+P)
- [ ] File Picker (@)
- [ ] Live progress tracking
- [ ] Full test coverage (80%+)
- [ ] Documentation complete

---

## üöÄ QUICK START NEXT SESSION

### Step 1: Load Context
```bash
/mem-context
cat temp/session-start.md
cat temp/warden_core_rules.md
cat NEXT_SESSION_INK_CLI.txt  # This file
```

### Step 2: Verify Build
```bash
cd /Users/alper/Documents/Development/Personal/warden-core/cli
npm run build
which warden-chat
```

### Step 3: Test IPC (Priority!)
```bash
# Terminal 1
python3 start_ipc_server.py

# Terminal 2
warden-chat
> /status
> /scan
```

### Step 4: Choose Task
- If tests pass ‚Üí Implement /validate
- If bugs found ‚Üí Fix bugs first
- If IPC fails ‚Üí Debug IPC connection

---

## üìù CODE PATTERNS TO FOLLOW

### Handler Pattern (Max 500 lines!)
```typescript
export async function handleCommandName(
  args: string,
  context: CommandHandlerContext
): Promise<void> {
  const { addMessage, client } = context;

  // 1. Validate args
  if (!args) {
    addMessage("‚ùå Error", MessageType.ERROR, true);
    return;
  }

  // 2. Check IPC if needed
  if (!client) {
    addMessage("‚ùå IPC not available", MessageType.ERROR, true);
    return;
  }

  // 3. Execute with error handling
  try {
    const result = await client.someMethod(args);
    displayResult(result, addMessage);
  } catch (error) {
    addMessage(`‚ùå Error: ${error.message}`, MessageType.ERROR, true);
  }
}

export const commandMetadata: CommandMetadata = {
  name: 'command',
  description: 'Description here',
  usage: '/command <args>',
  requiresIPC: true,
  handler: handleCommandName,
};
```

### Command List Filtering (Future)
```typescript
// Filter commands as user types
const filteredCommands = getAllCommands().filter(cmd => {
  if (!detection.command) return true; // Show all if just "/"
  return cmd.name.startsWith(detection.command);
});
```

---

## üíæ MEMORY SAVE

Session saved to mem0:
- ID: e24b3d1b-df43-4835-bb8b-fead88c728e9
- Contains: Full session summary, /scan implementation, slash list feature

---

**Last Updated:** 2025-12-22 13:30
**Status:** ‚úÖ Ready for Next Session
**Next Priority:** Test IPC + Implement /validate

START WITH: Testing existing features with IPC backend! üöÄ
